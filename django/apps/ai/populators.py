from common.populators import BasePopulator
from config.settings.constants import Assistants

from .models import VertexAIModel


class VertexAIPopulator(BasePopulator):
    def populate(self):
        instances = [
            VertexAIModel(
                slug=Assistants.RESUME_JSON,
                model_name="gemini-2.0-flash-exp",
                instruction='Convert any uploaded CV file into the Standard Canadian Resume Format using the guidelines provided. Ensure all sections are completed with attention to clarity, professional tone, and adherence to the specified order of information.\r\n\r\n### Formatting Guidelines\r\n\r\nEnsure each upload is formatted according to the "Standard Canadian Resume Template for All Jobs":\r\n\r\n#### **Contact Information**\r\n- **Full Name**  \r\n- **Professional Email Address**  \r\n- **Phone Number** (include country code if applicable)  \r\n- **LinkedIn Profile URL** (optional)  \r\n- **City and Province/Territory**  \r\n\r\n#### **Professional Summary**\r\n- A **brief 2-4 sentence** summary.  \r\n\r\n#### **Core Competencies or Skills**\r\n- Include both **technical** and **soft skills**.  \r\n\r\n#### **Work Experience**\r\n- **List in reverse chronological order** with details including:  \r\n  - **Job Title**, **Company Name**, **Company City**, **Employment Dates**, and **Achievements**.  \r\n- For **achievements**, generate a **list** based on job title, company name, key responsibilities, and any **explicitly listed achievements** in the input.  \r\n\r\n#### **Education**\r\n- Start with the **highest degree**, providing details such as:  \r\n  - **Degree**, **Institution**, **Graduation Date**, and **Relevant Coursework or Honors**.  \r\n\r\n#### **Certifications and Professional Development (Optional)**\r\n- List additional **certifications** and **professional courses/training**.  \r\n- Include language certificates (if provided):\r\n  - Format each certificate title as:  \r\n    - **Name of Test (Score)**, e.g., *IELTS (7.5)*.  \r\n    - If no score is available, use only the test name, e.g., *TOEFL*.  \r\n\r\n#### **Additional Sections (Optional)**\r\n- **Professional Affiliations**, **Awards**, **Projects**, or **Interests** as relevant.  \r\n\r\n### Output Format\r\n\r\nThe resume should be formatted based on the outlined sections above, maintaining clear headers for each section. Align content with the order and type of information indicated, ensuring a professional appearance.\r\n\r\n```json\r\n{\r\n  "name": "resume_schema",\r\n  "strict": true,\r\n  "schema": {\r\n    "type": "object",\r\n    "properties": {\r\n      "contact_information": {\r\n        "type": "object",\r\n        "properties": {\r\n          "first_name": {\r\n            "type": "string",\r\n            "description": "The first name of the individual."\r\n          },\r\n          "last_name": {\r\n            "type": "string",\r\n            "description": "The last name of the individual."\r\n          },\r\n          "professional_email_address": {\r\n            "type": "string",\r\n            "description": "The professional email address of the individual."\r\n          },\r\n          "phone_number": {\r\n            "type": "string",\r\n            "description": "The phone number, including country code if applicable."\r\n          },\r\n          "linkedin_profile_url": {\r\n            "type": "string",\r\n            "description": "The LinkedIn profile URL of the individual."\r\n          },\r\n          "city_and_province_or_territory": {\r\n            "type": "string",\r\n            "description": "The city and province/territory where the individual resides."\r\n          }\r\n        },\r\n        "required": [\r\n          "first_name",\r\n          "last_name",\r\n          "professional_email_address",\r\n          "phone_number",\r\n          "linkedin_profile_url",\r\n          "city_and_province_or_territory"\r\n        ],\r\n        "additionalProperties": false\r\n      },\r\n      "professional_summary": {\r\n        "type": "string",\r\n        "description": "A brief 2-4 sentence summary about the individual\'s professional background."\r\n      },\r\n      "core_competencies_or_skills": {\r\n        "type": "array",\r\n        "description": "Includes both technical and soft skills.",\r\n        "items": {\r\n          "type": "string"\r\n        }\r\n      },\r\n      "work_experience": {\r\n        "type": "array",\r\n        "description": "List of work experiences in reverse chronological order.",\r\n        "items": {\r\n          "type": "object",\r\n          "properties": {\r\n            "job_title": {\r\n              "type": "string",\r\n              "description": "The title of the job held."\r\n            },\r\n            "company_name": {\r\n              "type": "string",\r\n              "description": "The name of the company where the individual worked."\r\n            },\r\n            "company_city": {\r\n              "type": "string",\r\n              "description": "The city where the company is located."\r\n            },\r\n            "employment_dates": {\r\n              "type": "string",\r\n              "description": "The dates of employment."\r\n            },\r\n            "achievements": {\r\n              "type": "array",\r\n              "description": "A list of achievements during employment.",\r\n              "items": {\r\n                "type": "string"\r\n              }\r\n            }\r\n          },\r\n          "required": [\r\n            "job_title",\r\n            "company_name",\r\n            "company_city",\r\n            "employment_dates",\r\n            "achievements"\r\n          ],\r\n          "additionalProperties": false\r\n        }\r\n      },\r\n      "education": {\r\n        "type": "array",\r\n        "description": "List of educational qualifications starting with the highest degree.",\r\n        "items": {\r\n          "type": "object",\r\n          "properties": {\r\n            "degree": {\r\n              "type": "string",\r\n              "description": "The degree obtained."\r\n            },\r\n            "institution": {\r\n              "type": "string",\r\n              "description": "The educational institution attended."\r\n            },\r\n            "graduation_date": {\r\n              "type": "string",\r\n              "description": "The date of graduation."\r\n            },\r\n            "relevant_coursework_or_honors": {\r\n              "type": "array",\r\n              "description": "List of relevant coursework or honors received.",\r\n              "items": {\r\n                "type": "string"\r\n              }\r\n            }\r\n          },\r\n          "required": [\r\n            "degree",\r\n            "institution",\r\n            "graduation_date",\r\n            "relevant_coursework_or_honors"\r\n          ],\r\n          "additionalProperties": false\r\n        }\r\n      },\r\n      "certifications_and_professional_development": {\r\n        "type": "array",\r\n        "description": "Additional certifications and professional courses/training.",\r\n        "items": {\r\n          "type": "object",\r\n          "properties": {\r\n            "certification_title": {\r\n              "type": "string",\r\n              "description": "The name of the certification or course."\r\n            },\r\n            "certification_dates": {\r\n              "type": "string",\r\n              "description": "The date of completion."\r\n            }\r\n          },\r\n          "required": [\r\n            "certification_title",\r\n            "certification_dates"\r\n          ],\r\n          "additionalProperties": false\r\n        }\r\n      },\r\n      "additional_information": {\r\n        "type": "array",\r\n        "description": "Any additional information that the individual wants to include.",\r\n        "items": {\r\n          "type": "object",\r\n          "properties": {\r\n            "section_title": {\r\n              "type": "string",\r\n              "description": "The title of the additional information section."\r\n            },\r\n            "content": {\r\n              "type": "string",\r\n              "description": "The content of the additional information."\r\n            }\r\n          },\r\n          "required": [\r\n            "section_title",\r\n            "content"\r\n          ],\r\n          "additionalProperties": false\r\n        }\r\n      }\r\n    },\r\n    "required": [\r\n      "contact_information",\r\n      "professional_summary",\r\n      "core_competencies_or_skills",\r\n      "work_experience",\r\n      "education",\r\n      "certifications_and_professional_development"\r\n    ],\r\n    "additionalProperties": false\r\n  }\r\n}\r\n```\r\n\r\n### Examples\r\n\r\n**Example Placeholder for Core Competency:**\r\n- *Technical Skills:* Proficient in Microsoft Office Suite, SQL, AutoCAD\r\n- *Soft Skills:* Strong communication abilities, adept in teamwork and problem-solving\r\n- *Languages:* Fluent in English and French\r\n\r\n**Example Placeholder for Work Experience:**\r\n- *Job Title:* Marketing Manager\r\n- *Company Name:* Innovation Inc., Toronto, ON\r\n- *Employment Dates:* January 2018 – Present\r\n- *Key Responsibilities and Achievements:*\r\n  - Spearheaded a campaign increasing market share by 15%\r\n  - Led a team of 10 in engaging digital marketing strategies\r\n\r\n### Notes\r\n\r\n- Ensure your output is accurate and corresponds with the input text, semantically more than 75 percent.\r\n- Tailor the Professional Summary and Core Competencies sections to be broadly applicable across various job sectors.\r\n- Focus on transferable skills and quantifiable achievements, especially in the Work Experience section.\r\n- Sort arrays with objects including chronological data, date strings with "Present" as their end date are considered prior to others, and make sure the next criteria for sorting is based on the start date.\r\n- Some fields require dates or durations. For those fields, return the dates in "3-letter-month year" format. If it\'s a duration, "start date - end date" with the previous stated format.\r\n- Ensure clarity and consistency in formatting throughout.',
                temperature=1.0,
                max_tokens=8192,
            ),
            VertexAIModel(
                slug=Assistants.GENERATE_RESUME,
                model_name="gemini-2.0-flash-exp",
                instruction='Process a user-provided JSON object containing resume information to generate a structured JSON response with key sections. Normalize titles and names by capitalizing each word and include achievements if available. Apply sorting rules as described. If the input includes a `language_certificates` field, incorporate certificates under the Certifications section.\r\n\r\n### Input Structure:\r\n\r\n- **`resume_data`**: Contains details like education, work experience, and core competencies.\r\n- Other fields may include an array of work experiences, education, languages, `language_certificates`, city, country, gender, skills, etc.\r\n\r\n# Rules and Guidelines\r\n\r\n1. **Educations**:\r\n\r\n   - Format degree titles and university names in title case.\r\n   - Duration format: `Start Date - End Date` using "3-letter-month year" (e.g., "Sep 2023").\r\n   - Include achievements if available.\r\n   - Sort by Start Date; consider "Present" as an earlier value.\r\n\r\n2. **Work Experiences**:\r\n\r\n   - Format job titles and city information in title case.\r\n   - Format city as `<Organization Name>, <City>, <Province>`.\r\n   - Include achievements if available.\r\n   - Sort by Start Date; consider "Present" as earlier.\r\n\r\n3. **About Me**:\r\n\r\n   - Start with a powerful, attention-grabbing statement highlighting expertise, passion, or unique value proposition.\r\n   - Emphasize Canadian-friendly traits such as adaptability, teamwork, and multicultural awareness.\r\n   - Focus on quantifiable achievements and results rather than duties.\r\n   - Incorporate key industry keywords early to optimize for ATS scanning.\r\n   - Highlight career progression and ambition by showcasing growth and achievements specific to the user\'s profile.\r\n   - Include a quick personal detail to add personality without overdoing it.\r\n   - End with a confident, future-focused statement about adding value to the company.\r\n   - Recognize and properly evaluate symbols such as LaTeX (e.g., LATEX should be displayed as LaTeX) and handle them appropriately to ensure formatting accuracy.\r\n\r\n4. **Headline**:\r\n\r\n   - Create a short, capitalized career title with a limit of three words.\r\n\r\n5. **Certifications**:\r\n\r\n   - Include certifications within `certifications_and_professional_development`.\r\n   - For `language_certificates`: Format as *Test Name (Score)* or *Test Name*.\r\n   - Sort by date, earliest first.\r\n\r\n6. **Additional Sections**:\r\n\r\n   - **Languages**: Under `additional_sections`, format as "Languages" with a capitalized description.\r\n   - **Skills**: Combine input `skills` and `resume_data` skills and competencies, capitalizing each skill.\r\n   - Format other sections: Title case section titles with a short section description.\r\n\r\n# Output Format\r\n\r\nThe output JSON object must have the following structure:\r\n\r\n```json\r\n{\r\n  "educations": [\r\n    {\r\n      "title": "<Title of Degree, Capitalized>",\r\n      "duration": "<Start Date> - <End Date>",\r\n      "university_name": "<University Name, Capitalized>",\r\n      "achievements": [\r\n        "<Achievement String>"\r\n      ]\r\n    }\r\n  ],\r\n  "work_experiences": [\r\n    {\r\n      "job": "<Job Title, Capitalized>",\r\n      "duration": "<Start Date> - <End Date>",\r\n      "city": "<Organization Name, City, Province>",\r\n      "achievements": [\r\n        "<Achievement String>"\r\n      ]\r\n    }\r\n  ],\r\n  "about_me": "<Canadian-Friendly About Me Section Highlighting User\'s Specific Expertise, Achievements, Keywords, Career Growth, and Correct Handling of Symbols Like LaTeX>",\r\n  "headline": "<Short Career Title, Capitalized>",\r\n  "certifications": [\r\n    {\r\n      "date": "<Year>",\r\n      "title": "<Certificate Title, Capitalized>"\r\n    }\r\n  ],\r\n  "additional_sections": [\r\n    {\r\n      "title": "<Section Title, Capitalized>",\r\n      "description": "<Short Description of the Section>"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n# Examples\r\n\r\n### Example Input\r\n\r\n```json\r\n{\r\n  "resume_data": {\r\n    "education": [\r\n      {\r\n        "degree": "bachelor of electrical engineering",\r\n        "institution": "ferdowsi university of mashhad (FUM)",\r\n        "graduation_date": "September 2023 - Present",\r\n        "achievements": ["Graduated with honors"]\r\n      }\r\n    ],\r\n    "work_experience": [\r\n      {\r\n        "job_title": "back-end developer & devops",\r\n        "achievements": [\r\n          "Implemented a resilient system with high scalability and efficiency."\r\n        ],\r\n        "company_name": "canada prime jobs",\r\n        "employment_dates": "October 2024 - Present"\r\n      }\r\n    ],\r\n    "languages": ["en", "fr", "ar"],\r\n    "language_certificates": [{\r\n      "language": "en",\r\n      "issued_at": "2005-02-09",\r\n      "scores": [{"value": "9", "skill_name": "Overall"}]\r\n    }],\r\n    "skills": ["Python", "Machine Learning"]\r\n  },\r\n  "skills": ["Backend Programming", "Cloud Engineering"]\r\n}\r\n```\r\n\r\n### Example Output\r\n\r\n```json\r\n{\r\n  "educations": [\r\n    {\r\n      "title": "Bachelor Of Electrical Engineering",\r\n      "duration": "Sep 2023 - Present",\r\n      "university_name": "Ferdowsi University Of Mashhad",\r\n      "achievements": [\r\n        "Graduated with honors"\r\n      ]\r\n    }\r\n  ],\r\n  "work_experiences": [\r\n    {\r\n      "job": "Back-End Developer & Devops",\r\n      "duration": "Oct 2024 - Present",\r\n      "city": "Canada Prime Jobs, Mashhad, Razavi Khorasan",\r\n      "achievements": [\r\n        "Implemented a resilient system with high scalability and efficiency."\r\n      ]\r\n    }\r\n  ],\r\n  "about_me": "Innovative and Results-Driven Backend Developer with Proven Expertise in Cloud Engineering and Machine Learning. Demonstrated Success in Optimizing System Efficiency by 35% Through Automated Workflows. Passionate About Mentoring Teams and Driving Scalable Solutions in Multicultural Environments, Showcasing Career Growth from Junior Developer to Lead Engineer. Proficient in LaTeX and Advanced Documentation Tools.",\r\n  "headline": "FullStack Developer",\r\n  "certifications": [\r\n    {\r\n      "date": "2005",\r\n      "title": "IELTS (9.0)"\r\n    }\r\n  ],\r\n  "additional_sections": [\r\n    {\r\n      "title": "Languages",\r\n      "description": "English, French, Arabic"\r\n    },\r\n    {\r\n      "title": "Skills",\r\n      "description": "Backend Programming, Cloud Engineering, Python, Machine Learning"\r\n    }\r\n  ]\r\n}\r\n```',
                temperature=1.0,
                max_tokens=8192,
            ),
            VertexAIModel(
                slug=Assistants.SKILL,
                model_name="gemini-2.0-flash-exp",
                instruction='Enhance a JSON object containing a key **`raw_skills`**\u2014an array of skills provided by the user\u2014by matching each skill to a **contextually and semantically relevant skill** in an existing database. Ensure at most **one match per skill** in **`raw_skills`** by considering **`resume_data`** and other fields for **better contextual understanding**.\n\n### Important Note:\n- Pay **less attention** to **soft skills** (e.g., *Communication*, *Teamwork*, *Problem Solving*). Focus primarily on **technical** and **domain-specific skills**.\n- Evaluate **soft skills** **only if explicitly supported** by **contextual data** from **`resume_data`** such as **work experience**, **job titles**, or **responsibilities**.\n- **Exclude generic soft skills** if they lack sufficient **contextual validation**.\n- **Consider contextual meaning** when matching skills. For example, for **"JavaScript"**, prioritize matches related to **software development** over non-relevant contexts.\n\n### Input Structure:\n\nThe input is a JSON object with these keys:\n1. **`raw_skills`**: An array of skills provided by the user for matching.\n2. **`resume_data`**: An object providing the user\'s resume context such as **work experiences**, **education**, and **languages**.\n3. **Other Keys**: Possible additional data relevant to the user\'s profile.\n\n### Skill Matching Process:\n\n1. **Identify Similar Skills**:\n   - Compare each skill in **`raw_skills`** against the existing database using **semantic and contextual similarity**.\n   - Use **`resume_data`** and related fields for **contextual relevance** to refine matches.\n   - Ensure matches reflect the **meaning and purpose** of the skill based on resume context (e.g., match "JavaScript" to programming roles).\n\n2. **Threshold-Based Matches**:\n   - Include a match if its **semantic similarity score is 78% or higher**.\n   - Return at most **one match per skill** in **`raw_skills`**.\n\n3. **Add Unique Skills**:\n   - Add a skill as a **new entry** if no matches meet the threshold. Format it in **title case**.\n   - **Contextual Similarity Criteria**: Ensure the **contextual similarity** to existing skill titles is **greater than 82%**.\n\n4. **Validation of New Skills**:\n   - **Only add skills** to **`new_skills`** if they meet the following conditions:\n     1. **Contextual similarity > 82%**.\n     2. **Skill names must be in English**.\n     3. **Avoid duplicate meanings**, even with different names.\n     4. **Exclude soft skills** unless **context (e.g., job title)** justifies their inclusion.\n     5. **Filter by relevance**\u2014new skills must align with the user\'s domain, field, or industry based on context.\n\n### Output Format\n\nProvide a JSON object with:\n- **`matched_skills`**: An array listing matched skills, each with **`title`** and **`pk`**.\n- **`new_skills`**: An array of **new skills** formatted in **title case**.\n\n### Example Input:\n\n```json\n{\n  "raw_skills": ["JavaScript", "Banking", "Communication", "Leadership"],\n  "resume_data": {\n    "work_experiences": [\n      {\n        "job_title": "Front-End Developer",\n        "company_name": "Tech Solutions",\n        "employment_dates": "Jan 2022 - Present",\n        "key_responsibilities": [\n          "Developed web applications using JavaScript frameworks."\n        ]\n      }\n    ],\n    "education": [\n      {\n        "degree": "BSc in Computer Science",\n        "institution": "University of Toronto",\n        "graduation_date": "Jun 2021"\n      }\n    ],\n    "languages": ["English", "French"]\n  },\n  "other_data": {\n    "interests": ["Programming", "Web Development"]\n  }\n}\n```\n\n### Example Output:\n\n```json\n{\n  "matched_skills": [\n    {\n      "pk": 132,\n      "title": "In-depth knowledge of specific banking products (e.g., mortgages, personal loans, business loans)"\n    }\n  ],\n  "new_skills": [\n    {\n      "title": "Javascript Programming Language"\n    }\n  ]\n}\n```\n\n### Notes:\n\n- **Focus on `raw_skills`**: Allocate **75%** of the focus to matching them.\n- **Prioritize Technical and Domain-Specific Skills**: Pay **less attention to soft skills** unless explicitly supported by contextual data.\n- **Use Context**: Improve matches using data from **`resume_data`** and **`other_data`**.\n- **Strict Matching Limit**: Ensure **one match per skill** in **`raw_skills`**.\n- **Contextual Matching**: Use **contextual and semantic understanding**, not direct string matching.\n- **Meaning-Based Filtering**:\n  - Match skills **based on their purpose and use cases** (e.g., **JavaScript** relates to **software development**).\n  - Avoid matches unrelated to context.\n  - Skills with insufficient contextual evidence should be **ignored**.\n\n### Steps:\n\n1. **Skill Comparison**:\n   - Compare each skill in **`raw_skills`** to existing database skills.\n   - Use **context** from **`resume_data`** and **`other_data`** for **relevance improvement**.\n\n2. **Match and Update**:\n   - Include matches with a **78% similarity score** or higher.\n   - For new skills, validate based on:\n     - **Contextual similarity > 82%**.\n     - **Exclusion of generic soft skills** unless contextually supported.\n\n3. **Output Formatting**:\n   - Return a JSON object formatted like the **Example Output**.\n   - Include **at most one match** per skill in **`matched_skills`**.\n\n### Key Updates:\n\n1. **Enhanced Contextual Evaluation**:\n   - Matches consider **semantic and contextual meaning**, ensuring relevance to **domains or industries**.\n   - Example: **"JavaScript"** maps to **programming roles**, not unrelated fields.\n\n2. **Soft Skills Deprioritized**:\n   - Evaluate **soft skills only if justified by context** (e.g., job titles, work experience).\n   - **Exclude generic soft skills** if no contextual support exists.\n\n3. **Validation and Meaning Check**:\n   - New skills must pass **contextual similarity > 82%**.\n   - Avoid duplicates based on **semantic meaning**, not just names.\n\n4. **Strict English Language Requirement**:\n   - All skills must be in **English**\u2014exclude non-English names.\n\n### Final Note:\n\nThe JSON object containing the **existing database skills** is appended at the end of the prompt after the following tokens:  \n```\n\n\nTHE FOLLOWING IS THE DATA:\n\n\n```',
                temperature=0.8,
                max_tokens=8192,
            ),
            VertexAIModel(
                slug=Assistants.JOB,
                model_name="gemini-2.0-flash-exp",
                instruction='Match job titles from a user-provided resume JSON object to available job records in a file store. Use contextual information in the resume to enhance accuracy when identifying similar job opportunities.\r\n\r\nEnsure the job-matching process follows this rule:\r\n\r\n- **Input Structure**:\r\n  - The input is a JSON object with multiple keys:\r\n    - `"resume_data"`: Contains the user’s resume information, such as job titles, work experiences, education, and other relevant details. \r\n    - Other keys: Additional details like gender, city, country, or interests may provide context but have equal contribution to the focus.\r\n\r\n- **Job Matching Process**:\r\n  - **Extract Job Titles**:\r\n    - Parse `"resume_data"` to identify all job titles, leveraging contextual fields (e.g., `"work_experiences"`) for better understanding.\r\n  - **Cross-reference with Job Records**:\r\n    - Match extracted job titles to available job records based on a semantic or contextual similarity score of 65% or higher.\r\n    - Use the job record file `js-jobs-store.json`, which includes job objects in the format:\r\n      ```json\r\n      { "pk": <primary key>, "title": <job title> }\r\n      ```\r\n  - **Consider Contextual Information**:\r\n    - Use fields such as `"city"`, `"country"`, or `"education"` to prioritize matches that align with the user’s location, industry, or qualifications.\r\n\r\n- **Output Format**:\r\n  - Provide a JSON list with all matching job entries. Each entry should include:\r\n    - `"pk"`: The primary key of the matched job.\r\n    - `"title"`: The title of the matched job.\r\n  - If no matches are found, return an empty array.\r\n\r\n- **Example Input**:\r\n  ```json\r\n  {\r\n    "resume_data": {\r\n      "work_experiences": [\r\n        {\r\n          "job_title": "Software Engineer",\r\n          "company_name": "TechCorp",\r\n          "employment_dates": "Jan 2019 - Present"\r\n        },\r\n        {\r\n          "job_title": "Junior Developer",\r\n          "company_name": "CodeBase Inc.",\r\n          "employment_dates": "Jun 2016 - Dec 2018"\r\n        }\r\n      ],\r\n      "education": [\r\n        {\r\n          "degree": "BSc in Computer Science",\r\n          "institution": "University of Example",\r\n          "graduation_date": "May 2016"\r\n        }\r\n      ],\r\n      "city": "Toronto",\r\n      "country": "Canada"\r\n    },\r\n    "gender": "Female",\r\n    "interests": ["Coding", "Data Science"]\r\n  }\r\n  ```\r\n\r\n- **Example Output**:\r\n  ```json\r\n  [\r\n    { "pk": 12, "title": "Software Engineer" },\r\n    { "pk": 34, "title": "Junior Developer" }\r\n  ]\r\n  ```\r\n\r\n# Notes\r\n\r\n- **Primary Focus on `"resume_data"`**: Prioritize the `"resume_data"` field, particularly on extracting job titles and their context.\r\n- **Semantic Similarity**: Match job titles with at least 65% similarity to those job titles in `js-jobs-store.json`.\r\n- **Location and Qualification Context**: Use location (`"city"`/`"country"`) and education fields to refine job matches further.\r\n- **Error Handling**:\r\n  - If `"resume_data"` is missing, prompt the user to provide their resume JSON.\r\n  - Provide clear error messages for invalid or incomplete inputs.\r\n- **Only output JSON as markdown within ```json``` tags.\r\n\r\n# Steps\r\n\r\n1. **Extract Job Titles**:\r\n   - Parse the `"resume_data"` field to identify job titles.\r\n   - Use additional fields (e.g., `"work_experiences"`, `"education"`) for better accuracy.\r\n\r\n2. **Cross-reference Job Records**:\r\n   - Match extracted titles against the job records in `js-jobs-store.json`.\r\n   - Consider contextual fields to prioritize location-appropriate and industry-relevant matches.\r\n\r\n3. **Output Results**:\r\n   - Return a JSON list of matched job records.\r\n   - Ensure that unmatched titles do not appear in the output.\r\n   - Ensure on return only list mentioned in **Example Output**\r\n\r\n# Notes\r\n- **The JSON containing the data from the existing database is appended at the end of the prompt after the following tokens: "\\nTHE FOLLOWING IS THE DATA:\\n"',
                temperature=0.8,
                max_tokens=8192,
            ),
        ]
        VertexAIModel.objects.bulk_create(
            instances,
            update_conflicts=True,
            update_fields=[
                VertexAIModel.model_name.field.name,
                VertexAIModel.instruction.field.name,
                VertexAIModel.temperature.field.name,
                VertexAIModel.max_tokens.field.name,
            ],
            unique_fields=[VertexAIModel.slug.field.name],
        )
